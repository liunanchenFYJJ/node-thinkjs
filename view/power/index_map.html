<div id="container" class="layui-row">
    <blockquote class="layui-elem-quote">
        站点分布,以地图方式显示站点运行信息
        <!-- <div class="layui-form-item"> -->
            <div class="layui-inline">
                <label class="layui-form-label">地图模式</label>
                <div class="layui-input-inline">
                    <select name="city">
                        <option value=""></option>
                        <option value="0">自动判断</option>
                        <option value="1">白天模式</option>
                        <option value="2">夜间模式</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">状态过滤</label>
                <div class="layui-input-inline">
                    <select name="status">
                        <option value=""></option>
                        <option value="0">全部</option>
                        <option value="1">在线</option>
                        <option value="2">离线</option>
                        <option value="3">抢修</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">站点定位</label>
                <div class="layui-input-inline" style="width: 100px;">
                    <input type="text" name="" autocomplete="off" class="layui-input">
                </div>
            </div>
        <!-- </div> -->
    </blockquote>
    <div id="allmap"  class="layui-row"></div>
</div>
<style>
    #container{
        width: 100%-200px;
        height: 808px;
    }
    #allmap{
        width: 100%;height: 100%;overflow: hidden;margin:0;font-family:"微软雅黑";
    }
</style>
<script>
    (function(){
        layui.use('form', function(){
            var $ = layui.$;
            // 监听条件搜索

            // 使用地图
            var map = new BMap.Map("allmap");    
            var point = new BMap.Point(120.62, 31.32);    
            map.centerAndZoom(point, 11);        //设置地图默认粒度
            // map.centerAndZoom("苏州",11);      // 初始化地图,用城市名设置地图中心点            
            map.enableScrollWheelZoom(true);     //开启鼠标滚轮缩放
            map.enableInertialDragging();         //鼠标拖拽
            map.enableContinuousZoom();          //
            var size = new BMap.Size(10, 20);
            map.addControl(new BMap.CityListControl({
                anchor: BMAP_ANCHOR_TOP_LEFT,
                offset: size,
                // 切换城市之间事件
                // onChangeBefore: function(){
                //    alert('before');
                // },
                // 切换城市之后事件
                // onChangeAfter:function(){
                //   alert('after');
                // }
            }));
            //创建自定义图标
            var myIcon = new BMap.Icon('/static/img/factory.png', new BMap.Size(30,157));
            var marker2 = new BMap.Marker(point,{icon:myIcon});  // 创建标注
            map.addOverlay(marker2);              // 将标注添加到地图中
            var label = new BMap.Label("某监测点",{offset:new BMap.Size(30,4)});
            label.setStyle({
                color : "yellow",
                backgroundColor: "grey",
                border: "none",
                fontSize : "12px",
                height : "20px",
                lineHeight : "20px",
                fontFamily:"微软雅黑"
            });
	        marker2.setLabel(label);
            marker2.addEventListener("click",attribute);
            function attribute(){
                //多窗口模式，层叠置顶
                var that = this;
                layer.open({
                    type: 2 //此处以iframe举例
                    ,title: '子站运行简报'                 
                    ,area: ['800px', '400px']
                    ,shadeClose: true
                    ,maxmin: true
                    ,offset: 'auto'
                    ,content: '/power/index/content.html'
                    ,btn: ['前往子站', '关闭'] //只是为了演示
                    ,yes: function(){
                        $(that).click(); 
                    }
                    ,btn2: function(){
                        layer.closeAll();
                    }
                    
                    ,zIndex: layer.zIndex //重点1
                    ,success: function(layero){
                        layer.setTop(layero); //重点2
                    }
                });
            }
            // var myChart = echarts.init(document.getElementById('total_energy_map')); 
            // marker2.setAnimation(BMAP_ANIMATION_BOUNCE); //跳动的动画            
            // function addMarker(point, index){  // 创建图标对象   
            //     var myIcon = new BMap.Icon("/static/img/factory.png", new BMap.Size(30,157), {    
            //         // 指定定位位置。   
            //         // 当标注显示在地图上时，其所指向的地理位置距离图标左上    
            //         // 角各偏移10像素和25像素。您可以看到在本例中该位置即是   
            //         // 图标中央下端的尖角位置。    
            //         anchor: new BMap.Size(10, 25),    
            //         // 设置图片偏移。   
            //         // 当您需要从一幅较大的图片中截取某部分作为标注图标时，您   
            //         // 需要指定大图的偏移位置，此做法与css sprites技术类似。    
            //         imageOffset: new BMap.Size(0, 0 - index * 25)   // 设置图片偏移    
            //     });      
            //     // 创建标注对象并添加到地图   
            //     var marker = new BMap.Marker(point, {icon: myIcon});    
            //     map.addOverlay(marker);    
            // }  
            // 随机向地图添加25个标注
            function addMarker(point){
                var marker = new BMap.Marker(point);
                map.addOverlay(marker);
            }
            var bounds = map.getBounds();
            var sw = bounds.getSouthWest();
            var ne = bounds.getNorthEast();
            var lngSpan = Math.abs(sw.lng - ne.lng);
            var latSpan = Math.abs(ne.lat - sw.lat);
            for (var i = 0; i < 3; i ++) {
                var point = new BMap.Point(sw.lng + lngSpan * (Math.random() * 0.7), ne.lat - latSpan * (Math.random() * 0.7));
                addMarker(point);
            }  
        });
    }())
</script>